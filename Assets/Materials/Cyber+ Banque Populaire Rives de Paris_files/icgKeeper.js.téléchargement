var ICG_KEEPER=null;function IcgKeeper(e,i){this.icgTimeoutCookieName="icgTimeout",this.icgTimeoutAlertDelay=null==i||i<=0?210:i,this.checkIntervalDelay=6e4,this.checkIntervalMinimumDelay=30,this.keepAliveUrl=e,this.debug=!1,this.start=function(){this.logDebug("start - "+new Date),this.calculCheckIntervalDelayMs();var e=this.initTimeoutICGCookie();null!=window.icgInterval&&clearTimeout(window.icgInterval),window.icgInterval=setTimeout("ICG_KEEPER.checkIcgTimeoutAlertTime();",e),jQuery.ajaxSetup({complete:function complete(){ICG_KEEPER.start()}})},this.initTimeoutICGCookie=function(){var e=parseInt(getCookie(this.icgTimeoutCookieName)),i=!isNaN(e)&&e>=0,t=this.addMsDelayToCurrentDate(1e3*this.icgTimeoutAlertDelay),o=this.checkIntervalDelay;if(i){var a=new Date;this.logDebug("A- initTimeoutICGCookie - CURRENT Date Cookie : "+new Date(e));var l=e-a.getTime();l<-1*this.icgTimeoutAlertDelay*1e3?(this.logDebug("initTimeoutICGCookie - B - Le cookie a une valeur trop ancienne"),this.logDebug("initTimeoutICGCookie - NEW Date Cookie : "+new Date(t)),setCookie(this.icgTimeoutCookieName,t)):(l<2e3&&(l=2e3),l>this.checkIntervalDelay&&(this.logDebug("initTimeoutGSUCookie - A - Supérieure à l intervalle : "+l),l=this.checkIntervalDelay),l>2e3&&l<this.checkIntervalDelay&&(l+=1e3),o=l,this.logDebug("initTimeoutICGCookie - A - Planif du prochain check dans "+l+" ms"))}else this.logDebug("initTimeoutICGCookie - C - Pas de cookie ou cookie invalide"),this.logDebug("initTimeoutICGCookie - NEW Date Cookie : "+new Date(t)),setCookie(this.icgTimeoutCookieName,t);return this.logDebug("initTimeoutICGCookie - Next Check : "+this.currentDateWithMsDelay(o)),o},this.updateCookie=function(){var e=this.addMsDelayToCurrentDate(1e3*this.icgTimeoutAlertDelay);setCookie(this.icgTimeoutCookieName,e)},this.checkIcgTimeoutAlertTime=function(){var e=parseInt(getCookie(this.icgTimeoutCookieName));this.logDebug("checkIcgTimeoutAlertTime - "+new Date+" CURRENT Date Cookie : "+new Date(e));var i="checkIcgTimeoutAlertTime - Valeur du cookie invalide ou dans le future => Pas d appel ICG";null!=e&&"null"!=e&&(new Date(parseInt(e))<new Date&&(i="checkIcgTimeoutAlertTime - Valeur du cookie dans le passé => Appel ICG",this.icgServerRequest()));this.logDebug(i),null!=window.icgInterval&&clearTimeout(window.icgInterval),window.icgInterval=setTimeout("ICG_KEEPER.checkIcgTimeoutAlertTime();",this.checkIntervalDelay)},this.icgServerRequest=function(){null!=this.keepAliveUrl&&jQuery.ajax({url:this.keepAliveUrl,type:"GET",cache:!1,xhrFields:{withCredentials:!0},complete:function complete(){ICG_KEEPER.updateCookie()}})},this.logDebug=function(e){this.debug&&console.log(e)},this.currentDateWithMsDelay=function(e){var i=new Date;return i.setMilliseconds(i.getMilliseconds()+e),i},this.addMsDelayToCurrentDate=function(e){return this.currentDateWithMsDelay(e).getTime()},this.calculCheckIntervalDelayMs=function(){var e=10*Math.trunc(Math.trunc(this.icgTimeoutAlertDelay/5)/10);e=e>this.checkIntervalMinimumDelay?e:this.checkIntervalMinimumDelay,this.checkIntervalDelay=1e3*e}}
//# sourceMappingURL=icgKeeper.js.map
