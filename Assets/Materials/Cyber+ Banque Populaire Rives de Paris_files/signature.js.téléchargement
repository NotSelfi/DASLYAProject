var AD_CONSTANTS={3:{ADSIGNER_CLASS:"com.dictao.adsigner.applet.AdSigner",CANCEL_ERROR_CODE:"1",MASK_APPLET_WITH_ERROR_CODES:new Array("41","42","51","52","54","101")},5:{ADSIGNER_CLASS:"com.dictao.adsigner.Main",CANCEL_ERROR_CODE:"1",MASK_APPLET_WITH_ERROR_CODES:new Array("111","121","101","112","2","132")},TurboSignExtension:{ADSIGNER_CLASS:"",CANCEL_ERROR_CODE:"ERR_11_ACTION_ANNULEE_PAR_UTILISATEUR",MASK_APPLET_WITH_ERROR_CODES:new Array("ERR_03_NO_CERTIFICATE_SELECTED","ERR_05_CERTIFICATE_NOT_FOUND","ERR_07_CODE_PIN_INCORRECT","ERR_08_SIGN_FAILED","ERR_13_TIMEOUT_EXPIRED","ERR_14_OS_NOT_SUPPORTED","ERR_15_STORE_NOT_ACCESSIBLE","ERR_16_PROBLEM_GETTING_CERTIFICATES_FROM_STORE")}},DEFAULT_APP_VERSION="3",DICTAO_ACTION_URI="DICTAO_ACTION_URI",appletContainerId=null,appletVersion=null,l_TW=TW(),functionRetrySignTurbo=null;function insertAdSignerWeb(e,r,t,n,E,o,i,_,a,T){if(isUsedTurboSignChrome(T))(functionRetrySignTurbo=function functionRetrySignTurbo(){signWithChromeExtension(e,r,n,E,o,T)})();else if(isUsedTurboSignFirefox(T))(functionRetrySignTurbo=function functionRetrySignTurbo(){signWithFirefoxExtension(e,r,n,E,o,T)})();else{setAppletVersion(null==a?DEFAULT_APP_VERSION:a);var R=new l_TW.ATEApplet(getAppletConsts().ADSIGNER_CLASS,t,n,E,o,i,_);setTimeout((function(){R.write(e,r)}),0),setAppletContainerId(r)}}function isUsedTurboSignChrome(e){var r=!1,t=get_browser_info(),n=getTurboParams("SIGNATURE_TURBOSIGN_CHROME_ACTIVER",e),E=getTurboParams("SIGNATURE_TURBOSIGN_CHROME_VERSIONNAVIGATEURMINIMUN",e),o=getTurboParams("SIGNATURE_TURBOSIGN_ALL_MAC_ACTIVER",e),i=!!navigator.platform.match(/(Mac|iPhone|iPod|iPad)/i);return/Chrome/.test(navigator.userAgent)&&chrome&&"true"==n&&"Chrome"===t.name&&parseInt(t.version)>=parseInt(E)&&(i?"true"==o&&(r=!0):r=!0),r}function isUsedTurboSignFirefox(e){var r=!1,t=get_browser_info(),n=getTurboParams("SIGNATURE_TURBOSIGN_FIREFOX_ACTIVER",e),E=getTurboParams("SIGNATURE_TURBOSIGN_FIREFOX_VERSIONNAVIGATEURMINIMUN",e),o=getTurboParams("SIGNATURE_TURBOSIGN_ALL_MAC_ACTIVER",e),i=!!navigator.platform.match(/(Mac|iPhone|iPod|iPad)/i);return"true"===n&&"Firefox"===t.name&&parseInt(t.version)>=parseInt(E)&&(i?"true"==o&&(r=!0):r=!0),r}function get_browser_info(){var e,r=navigator.userAgent,t=r.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(t[1])?{name:"IE ",version:(e=/\brv[ :]+(\d+)/g.exec(r)||[])[1]||""}:"Chrome"===t[1]&&null!=(e=r.match(/\bOPR\/(\d+)/))?{name:"Opera",version:e[1]}:(t=t[2]?[t[1],t[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(e=r.match(/version\/(\d+)/i))&&t.splice(1,1,e[1]),{name:t[0],version:t[1]})}function compareVersion(e,r){for(var t=e.toString().split("."),n=r.toString().split("."),E=0;E<t.length;E++){if(t[E]>n[E])return!1;if(t[E]<n[E])return!0}return!0}var showMsgRetryPluginTurbo=null;function signWithChromeExtension(e,r,t,n,E,o){for(var i=e.document.getElementById(r),_=getTurboParams("SIGNATURE_TURBOSIGN_CHROME_IDEXTENSION",o),a=getTurboParams("SIGNATURE_TURBOSIGN_CHROME_VERSIONPLUGINMINIMUN",o),T=getTurboParams("SIGNATURE_TURBOSIGN_CHROME_VERSIONEXECUTABLEMINIMUN",o),R="",s="",S=E.length,I=0;I<S;I++){var u=E[I];"FILTER_SERIAL"===u.key&&(R=u.value),"DATA"===u.key&&(s=u.value)}function getMsgErrorPluginVersion(){return getMsgLink("SIGNATURE_TURBOSIGN_ALL_MESSAGE_PLUGINPASAJOUR","SIGNATURE_TURBOSIGN_CHROME_MESSAGE_LIENSTORE_URL","SIGNATURE_TURBOSIGN_CHROME_MESSAGE_LIENSTORE_TXT")}function getMsgErrorExecutableVersion(){return getMsgLink("SIGNATURE_TURBOSIGN_ALL_MESSAGE_EXECUTABLEPASAJOUR","SIGNATURE_TURBOSIGN_CHROME_MESSAGE_LIENEXE_URL","SIGNATURE_TURBOSIGN_CHROME_MESSAGE_LIENEXE_TXT")}function getMsgLink(e,r,t){return'<br/><p style="margin:auto">'+getTurboParams(e,o)+'<br/><br/><a style="margin:auto;color:blue;text-decoration: underline;" href="'+getTurboParams(r,o)+'" target="_blank"  onclick="showMsgRetryPluginTurbo()">'+getTurboParams(t,o)+"</a><br/><br/>"}chrome.runtime.sendMessage(_,{areYouThere:!0},(function(e){e?chrome.runtime.sendMessage(_,{getVersion:!0},(function(e){e&&compareVersion(a,e)?chrome.runtime.sendMessage(_,{testerPresenceExecutable:"0"},(function(e){!e||void 0===e||e.indexOf("ERR")>-1?i.innerHTML=function getMsgErrorExecutableAbsent(){return getMsgLink("SIGNATURE_TURBOSIGN_ALL_MESSAGE_EXECUTABLEABSENT","SIGNATURE_TURBOSIGN_CHROME_MESSAGE_LIENEXE_URL","SIGNATURE_TURBOSIGN_CHROME_MESSAGE_LIENEXE_TXT")}():chrome.runtime.sendMessage(_,{data:{action:"GetVersion"}},(function(e){if(e&&e.text)if(compareVersion(T,e.text)){var r=getTurboParams("SIGNATURE_TURBOSIGN_ALL_MESSAGE_DEUXIEMEFENETRE_CORPS",o);i.innerHTML=r,setAppletVersion("TurboSignExtension");var E=getTurboParams("SIGNATURE_TURBOSIGN_ALL_CORRECTION_LARGEUR",o);E=parseInt(E)||0;var a=getTurboParams("SIGNATURE_TURBOSIGN_ALL_CORRECTION_HAUTEUR",o);a=parseInt(a)||0;var S=parseInt(n)+E,I=parseInt(t)+a,u=getTurboParams("SIGNATURE_TURBOSIGN_ALL_MESSAGE_DEUXIEMEFENETRE_TITRE",o),A=getTurboParams("SIGNATURE_POLICY_URI_KEY",o);chrome.runtime.sendMessage(_,{data:{action:"ValidationCyber",largeurFenetre:S,hauteurFenetre:I,filterSerial:R,dataHtmlB64:s,titreFenetre:u,URLConditionGenerales:A}},(function(e){var r;e&&e.text&&e.statut&&"OK"==e.statut?sendSignature(e.text):(r=e?e.text?e.text:"NO_TEXT":"NO_RESPONSE",i.innerHTML="",getError(r))}))}else i.innerHTML=getMsgErrorExecutableVersion();else i.innerHTML=getMsgErrorExecutableVersion()}))})):i.innerHTML=getMsgErrorPluginVersion()})):i.innerHTML=function getMsgErrorPluginAbsent(){return getMsgLink("SIGNATURE_TURBOSIGN_ALL_MESSAGE_NONINSTALLE","SIGNATURE_TURBOSIGN_CHROME_MESSAGE_LIENSTORE_URL","SIGNATURE_TURBOSIGN_CHROME_MESSAGE_LIENSTORE_TXT")}()})),showMsgRetryPluginTurbo=function showMsgRetryPluginTurbo(){i.innerHTML=function getMsgRetrySignTurbo(){return'<br/><p style="margin:auto">'+getTurboParams("SIGNATURE_TURBOSIGN_ALL_MESSAGE_REESAYERDEMARRAGEPLUGIN",o)+' <a style="margin:auto;color:blue;text-decoration: underline;" href="javascript:functionRetrySignTurbo();" >'+getTurboParams("SIGNATURE_TURBOSIGN_ALL_MESSAGE_LIEN_REESAYERDEMARRAGEPLUGIN_TXT",o)+"</a><br/><br/>"}()}}function signWithFirefoxExtension(e,r,t,n,E,o){for(var i=e.document.getElementById(r),_=getTurboParams("SIGNATURE_TURBOSIGN_FIREFOX_VERSIONPLUGINMINIMUN",o),a=getTurboParams("SIGNATURE_TURBOSIGN_FIREFOX_VERSIONEXECUTABLEMINIMUN",o),T="",R="",s=E.length,S=0;S<s;S++){var I=E[S];"FILTER_SERIAL"===I.key&&(T=I.value),"DATA"===I.key&&(R=I.value)}function getMsgLink(e,r,t){return'<br/><p style="margin:auto">'+getTurboParams(e,o)+'<br/><br/><a style="margin:auto;color:blue;text-decoration: underline;" href="'+getTurboParams(r,o)+'" target="_blank"  onclick="showMsgRetryPluginTurbo()">'+getTurboParams(t,o)+"</a><br/><br/>"}!function isExtensionOK(){appelExtensionFirefox("areYouThere",200,(function(e){e?function isVersionExtensionOK(){appelExtensionFirefox("getVersion",200,(function(e){e&&compareVersion(_,e)?function isExecutableOK(){appelExtensionFirefox("testerPresenceExecutable",2e3,(function(e){!0===e||"OK"==e?function isVersionExecutableOK(){appelExtensionFirefox({action:"GetVersion"},2e3,(function(e){e&&compareVersion(a,e)?function callSignWithTurbo(){var e=getTurboParams("SIGNATURE_TURBOSIGN_ALL_MESSAGE_DEUXIEMEFENETRE_CORPS",o);i.innerHTML=e,setAppletVersion("TurboSignExtension");var r=getTurboParams("SIGNATURE_TURBOSIGN_ALL_CORRECTION_LARGEUR",o);r=parseInt(r)||0;var E=getTurboParams("SIGNATURE_TURBOSIGN_ALL_CORRECTION_HAUTEUR",o);E=parseInt(E)||0;var _=parseInt(n)+r,a=parseInt(t)+E,s=getTurboParams("SIGNATURE_TURBOSIGN_ALL_MESSAGE_DEUXIEMEFENETRE_TITRE",o),S=getTurboParams("SIGNATURE_POLICY_URI_KEY",o);appelExtensionFirefox({action:"Signer",largeurFenetre:_,hauteurFenetre:a,filterSerial:T,dataHtmlB64:R,titreFenetre:s,URLConditionGenerales:S},!1,(function(e){var r;e&&e.text&&e.statut&&"OK"==e.statut?sendSignature(e.text):(r=e?e.text?e.text:"NO_TEXT":"NO_RESPONSE",i.innerHTML="",getError(r))}))}():i.innerHTML=function getMsgErrorExecutableVersion(){return getMsgLink("SIGNATURE_TURBOSIGN_ALL_MESSAGE_EXECUTABLEPASAJOUR","SIGNATURE_TURBOSIGN_FIREFOX_MESSAGE_LIENEXE_URL","SIGNATURE_TURBOSIGN_FIREFOX_MESSAGE_LIENEXE_TXT")}()}))}():i.innerHTML=function getMsgErrorExecutableAbsent(){return getMsgLink("SIGNATURE_TURBOSIGN_ALL_MESSAGE_EXECUTABLEABSENT","SIGNATURE_TURBOSIGN_FIREFOX_MESSAGE_LIENEXE_URL","SIGNATURE_TURBOSIGN_FIREFOX_MESSAGE_LIENEXE_TXT")}()}))}():i.innerHTML=function getMsgErrorPluginVersion(){return getMsgLink("SIGNATURE_TURBOSIGN_ALL_MESSAGE_PLUGINPASAJOUR","SIGNATURE_TURBOSIGN_FIREFOX_MESSAGE_LIENSTORE_URL","SIGNATURE_TURBOSIGN_FIREFOX_MESSAGE_LIENSTORE_TXT")}()}))}():i.innerHTML=function getMsgErrorPluginAbsent(){return getMsgLink("SIGNATURE_TURBOSIGN_ALL_MESSAGE_NONINSTALLE","SIGNATURE_TURBOSIGN_FIREFOX_MESSAGE_LIENSTORE_URL","SIGNATURE_TURBOSIGN_FIREFOX_MESSAGE_LIENSTORE_TXT")}()}))}(),showMsgRetryPluginTurbo=function showMsgRetryPluginTurbo(){i.innerHTML=function getMsgRetrySignTurbo(){return'<br/><p style="margin:auto">'+getTurboParams("SIGNATURE_TURBOSIGN_ALL_MESSAGE_REESAYERDEMARRAGEPLUGIN",o)+' <a style="margin:auto;color:blue;text-decoration: underline;" href="javascript:functionRetrySignTurbo();" >'+getTurboParams("SIGNATURE_TURBOSIGN_ALL_MESSAGE_LIEN_REESAYERDEMARRAGEPLUGIN_TXT",o)+"</a><br/><br/>"}()}}function appelExtensionFirefox(e,r,t){new Promise((function(t,n){r&&setTimeout((function(){t(!1)}),r),window.top.addEventListener("turbosign-cyber-from-content-script",(function(e){if(IsJsonString(e.detail)){var r=JSON.parse(e.detail);t(r)}else t(e.detail)}));var E=new CustomEvent("turbosign-cyber-from-page-script",{detail:e});window.top.dispatchEvent(E)})).then((function(e){"function"==typeof t&&t.call(this,e)}))}function IsJsonString(e){try{JSON.parse(e)}catch(e){return!1}return!0}function getTurboParams(e,r){for(var t=null,n=0;n<r.length;n++){var E=r[n];E.key===e&&(t=E.value)}return t}function initDSBActions(e,r,t){e.DSB_CANCEL_ACTION=r,e.DSB_SIGN_ACTION=t}function getError(e){switch(e){case getAppletConsts().CANCEL_ERROR_CODE:selectActionButton(DSB_CANCEL_ACTION);break;default:var r=getMsgUtil().getMessage(e);if(null!=r){showFctErrorMessage(e,r);break}showTechErrorMessage(e)}}function showFctErrorMessage(e,r){if(TW().ArrayUtils.contains(getAppletConsts().MASK_APPLET_WITH_ERROR_CODES,e)){var t=getAppletContainerId();if(null!=t){var n=document.getElementById(t);null!=n&&l_TW.maskStyle(n)}}var E=new l_TW.FctError(e,r);l_TW.FctError.addFctError(window,E),l_TW.FctError.showFctErrors(window)}function showTechErrorMessage(e){var r=getMsgUtil().getMessage(DICTAO_ACTION_URI);l_TW.Assert.assert(null!=r,"[getError] : L'URI de l'action de traitement de l'erreur ne peut être à null");var t=new l_TW.URL(r);t.addParameter(l_TW.URL.ERROR_CODE_PARAMETER,e),window.location.href=t.toString()}function sendSignature(e){var r=document.getElementById("myForm").elements.sigValue;l_TW.Assert.assert(null!=r,"[sendSignature] : Le champ caché signature doit impérativement être présent dans la page"),r.value=e,selectActionButton(DSB_SIGN_ACTION)}function setAppletContainerId(e){appletContainerId=e}function getAppletContainerId(){return appletContainerId}function setAppletVersion(e){appletVersion=e}function getAppletConsts(){return AD_CONSTANTS[appletVersion]}
//# sourceMappingURL=signature.js.map
