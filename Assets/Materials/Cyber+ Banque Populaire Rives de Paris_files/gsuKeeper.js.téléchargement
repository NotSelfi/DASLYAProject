var GSU_KEEPER=null;function GsuKeeper(e,t,i,o,u,s,l){this.gsuTimeoutCookieName="gsuTimeout",this.gsuTimeoutAlertDelay=null==i||i<=0?210:i,this.checkIntervalDelay=6e4,this.checkIntervalMinimumDelay=30,this.keepAliveUrl=e,this.debug=!1,this.start=function(){this.logDebug("start - "+new Date),this.calculCheckIntervalDelayMs();var e=this.initTimeoutGsuCookie();null!=window.gsuInterval&&clearTimeout(window.gsuInterval),window.gsuInterval=setTimeout("GSU_KEEPER.checkGsuTimeoutAlertTime();",e),jQuery.ajaxSetup({complete:function complete(){GSU_KEEPER.start()}})},this.stop=function(){deleteCookie(this.gsuTimeoutCookieName),null!=window.gsuInterval&&clearTimeout(window.gsuInterval),setTimeout((function(e){GSU_KEEPER=null}),200)},this.initTimeoutGsuCookie=function(){var e=new Date,t=parseInt(getCookie(this.gsuTimeoutCookieName)),i=!isNaN(t)&&t>=0,o=this.addMsDelayToCurrentDate(1e3*this.gsuTimeoutAlertDelay),u=this.checkIntervalDelay;if(i){this.logDebug("A- initTimeoutGSUCookie - CURRENT Date Cookie : "+new Date(t));var s=t-e.getTime();s<-1*this.gsuTimeoutAlertDelay*1e3?(this.logDebug("initTimeoutGSUCookie - B - Le cookie a une valeur trop ancienne"),this.logDebug("initTimeoutGSUCookie - NEW Date Cookie : "+new Date(o)),setCookie(this.gsuTimeoutCookieName,o)):(s<2e3&&(s=2e3),s>this.checkIntervalDelay&&(this.logDebug("initTimeoutGSUCookie - A - Supérieure à l intervalle : "+s),s=this.checkIntervalDelay),s>2e3&&s<this.checkIntervalDelay&&(s+=1e3),u=s,this.logDebug("initTimeoutGSUCookie - A - Planif du prochain check dans "+s+" ms"))}else this.logDebug("initTimeoutGSUCookie - C - Pas de cookie ou cookie invalide"),this.logDebug("initTimeoutGSUCookie - NEW Date Cookie : "+new Date(o)),setCookie(this.gsuTimeoutCookieName,o);return this.logDebug("initTimeoutGSUCookie - Next Check : "+this.currentDateWithMsDelay(u)),u},this.updateCookie=function(){var e=this.addMsDelayToCurrentDate(1e3*this.gsuTimeoutAlertDelay);setCookie(this.gsuTimeoutCookieName,e)},this.checkGsuTimeoutAlertTime=function(){var e=parseInt(getCookie(this.gsuTimeoutCookieName));this.logDebug("checkGSUTimeoutAlertTime - "+new Date+" CURRENT Date Cookie : "+new Date(e));var t="checkGSUTimeoutAlertTime - Valeur du cookie invalide ou dans le future => Pas d appel GSU";null!=e&&"null"!=e&&(new Date(parseInt(e))<new Date&&(t="checkGSUTimeoutAlertTime - Valeur du cookie dans le passé => Appel GSU",this.gsuServerRequest()));this.logDebug(t),null!=window.gsuInterval&&clearTimeout(window.gsuInterval),window.gsuInterval=setTimeout("GSU_KEEPER.checkGsuTimeoutAlertTime();",this.checkIntervalDelay)},this.gsuServerRequest=function(){null!=this.keepAliveUrl&&jQuery.ajax({url:this.keepAliveUrl,type:"GET",cache:!1,xhrFields:{withCredentials:!0},complete:function complete(e){200!=e.status?e.responseText.indexOf(u)>-1?logout(o,s):(new IcgKeeper(t,l).start(),GSU_KEEPER.stop()):GSU_KEEPER.updateCookie()}})},this.logDebug=function(e){this.debug&&console.log(e)},this.currentDateWithMsDelay=function(e){var t=new Date;return t.setMilliseconds(t.getMilliseconds()+e),t},this.addMsDelayToCurrentDate=function(e){return this.currentDateWithMsDelay(e).getTime()},this.calculCheckIntervalDelayMs=function(){var e=10*Math.trunc(Math.trunc(this.gsuTimeoutAlertDelay/5)/10);e=e>this.checkIntervalMinimumDelay?e:this.checkIntervalMinimumDelay,this.checkIntervalDelay=1e3*e}}
//# sourceMappingURL=gsuKeeper.js.map
