var NGAgentServer=function(){"use strict";var e=["get","set","init","getBapiContext","getCustomerId"],t="ATE-NGAGENT-DATA_",i="DEFAULT";function Methods(){this.get=function(e,i){var o=void 0,r=this.targetWindow.sessionStorage.getItem(t+this.appCode),s=null;if(null!=r)try{o=new Map(JSON.parse(r)).get(i.param.key)}catch(e){s="Error parsing data from Store"}null===s?e.source.postMessage({id:i.id,data:o},e.origin):e.source.postMessage({id:i.id,error:s},e.origin)},this.set=function(e,i){var o=null,r=this.targetWindow.sessionStorage.getItem(t+this.appCode),s=null;if(null!=r)try{o=new Map(JSON.parse(r))}catch(e){s="Error parsing data from Store"}if(null===s){null===o&&(o=new Map);try{o.set(i.param.key,i.param.value),this.targetWindow.sessionStorage.setItem(t+this.appCode,JSON.stringify(Array.from(o.entries())))}catch(e){s="Error writing data to Store"}}null===s?e.source.postMessage({id:i.id},e.origin):e.source.postMessage({id:i.id,error:s},e.origin)},this.init=function(e,t){this.appCode=t.param.appCode,e.source.postMessage({id:t.id},e.origin)},this.getBapiContext=function(e,t){e.source.postMessage({id:t.id,data:this.bapiContext},e.origin)},this.getCustomerId=function(e,t){t.param.key="ATE_CUSTOMER_ID",this.get(e,t)}}return function CrossDomainServer(o,r,s,n){var a=new Methods,g=function handleMessage(t){var i=t.data,o=r.filter((function(e){return t.origin===e}))[0],n=i&&i.id&&~i.id.indexOf("sessionAccessId-")?i.id:null;if(n)if(o)if(s){var g=i.method;~e.indexOf(g)?a[g](t,i):t.source.postMessage({id:n,error:"".concat(g," is not an allowed method from ").concat(t.origin)},t.origin)}else t.source.postMessage({id:n,error:"user is not connected"},t.origin);else t.source.postMessage({id:n,error:"".concat(t.origin," is not an allowed domain")},t.origin)};this.init=function(){a.targetWindow=o,n&&(a.bapiContext=n),o.addEventListener("message",g)},this.initFromEquinoxe=function(e,r){e||(e=i);var s=new Array;r.forEach((function(e,t){s.push([t,e])})),o.sessionStorage.removeItem(t+e),o.sessionStorage.setItem(t+e,JSON.stringify(s))},this.cleanFromEquinoxe=function(){for(var e=0;e<o.sessionStorage.length;e++){var i=o.sessionStorage.key(e);i&&i.substring(0,t.length)==t&&o.sessionStorage.removeItem(i)}}}}();
//# sourceMappingURL=ngAgentServer.js.map
