function URL(e){this.urlPath=URL.extractURLPath(e),this.parameters=URL.extractURLParameters(e),this.hash=URL.extractURLHash(e)}function URLParameter(e,t){this.name=e,this.value=t}function saveToken(e){var t=APD(),r=null;if(null!=t){var n=t.getElementsByName(URL.TOKEN_PARAMETER);n&&(r=n[0])}if(void 0!==TW()&&null!=e)TW().token=e,null!=r&&(r.value=e);else if(null!=r){var a=r.value;TW().token=a}}function getCurrentToken(){return TW().token}URL.SEARCHPART_SEPARATOR="?",URL.PARAMETER_SEPARATOR="&",URL.NAME_VALUE_SEPARATOR="=",URL.HASH_SEPARATOR="#",URL.TOKEN_PARAMETER="token",URL.ERROR_CODE_PARAMETER="errorCode",URL.WEB_APP_TARGET_PARAMETER="webAppTarget",URL.extractURLPath=function(e){var t=e.indexOf(URL.SEARCHPART_SEPARATOR);return-1!=t?e.substring(0,t):e},URL.extractURLParameters=function(e){var t=e.indexOf(URL.SEARCHPART_SEPARATOR);if(-1==t)return null;var r=e.indexOf(URL.HASH_SEPARATOR),n=e.length;-1!=r&&(n=r);for(var a=e.substring(t+1,n).split(URL.PARAMETER_SEPARATOR),s=a.length,o=[],u=0;u<s;u++){var c=a[u].indexOf(URL.NAME_VALUE_SEPARATOR),i=new URLParameter(a[u].substr(0,c),a[u].substr(c+1,a[u].length));o.push(i)}return o},URL.extractURLHash=function(e){var t=e.indexOf(URL.HASH_SEPARATOR);return-1!=t?e.substring(t,e.length):null},URL.prototype.constructor=URL,URL.prototype={getParameters:function getParameters(){return null==this.parameters&&(this.parameters=[]),this.parameters},getParameter:function getParameter(e){var t=this.getParameters();if(t.length>0)for(var r=this.getParameters().length,n=0;n<r;n++){var a=t[n];if(a.getName()==e)return a}return null},modifyParameter:function modifyParameter(e,t){this.containsParameter(e)&&this.getParameter(e).setValue(t)},containsParameter:function containsParameter(e){return null!=this.getParameter(e)},addParameter:function addParameter(e,t){var r=this.getParameter(e);null==r?(r=new URLParameter(e,t),this.getParameters().push(r)):r.setValue(t)},getHash:function getHash(){return this.hash},toString:function toString(){var e=this.urlPath;return null!==this.parameters&&(e+=URL.SEARCHPART_SEPARATOR,e+=this.parameters.join(URL.PARAMETER_SEPARATOR)),null!==this.hash&&(e+=this.hash),e}},URLParameter.prototype.constructor=URLParameter,URLParameter.prototype={getName:function getName(){return this.name},getValue:function getValue(){return this.value},setValue:function setValue(e){this.value=e},toString:function toString(){return this.name+URL.NAME_VALUE_SEPARATOR+this.value}};var gctkn=getCurrentToken;function addTokenParameter(e,t){if(Assert.assert(null!=e,"[addTokenParameter] : in_object ne peut être à null"),"string"==typeof e)return addTokenParameterToURL(e,t);"a"==e.tagName.toLowerCase()&&addTokenParameterToAnchor(e,t)}var atp=addTokenParameter;function addTokenParameterToAnchor(e,t){e.href=addTokenParameterToURL(e.href,t)}function addTokenParameterToURL(e,t){var r=getCurrentToken();if(null!=r){var n=new URL(e);return n.containsParameter(URL.TOKEN_PARAMETER)?n.getParameter(URL.TOKEN_PARAMETER).setValue(getCurrentToken()):n.addParameter(URL.TOKEN_PARAMETER,getCurrentToken()),null!=t&&(n.containsParameter(URL.WEB_APP_TARGET_PARAMETER)?n.getParameter(URL.WEB_APP_TARGET_PARAMETER).setValue(t):n.addParameter(URL.WEB_APP_TARGET_PARAMETER,t)),n.toString()}return Assert.assert(null!=r,"[addTokenParameter] : Le token ne peut être null sur le poste client"),e}function insertPostSubTknHashKey(e){APD().getElementById(["t","o","k","e","n"].join("")).value=getTknHashKey(e)}var ipthk=insertPostSubTknHashKey;function getTknHashKey(e){var t=gctkn(),r=[];try{null!=e&&null!=t&&Object.keys(e).forEach((function(n){r.push(t.charAt(e[n]))})),t+=r.join("")}catch(e){}return t}function AccessToken(e,t,r){this.type=e,this.token=t;var n=new Date;n.setSeconds(n.getSeconds()+r),this.expiresAt=n.getTime()}function saveAccToken(e){var t=e.accessToken,r=e.expiresIn,n=new AccessToken(e.tokenType,t,r);TW().accessToken=n}AccessToken.prototype.constructor=AccessToken,AccessToken.REFRESH_TOKEN_URI="refreshAccessTokenURI",AccessToken.CURRENT_ACCESS_TOKEN_PARAM="Authorization",AccessToken.INVALID_ACCESS_TOKEN_HTTP_STATUS=403,AccessToken.prototype.expiresAt=function(){return this.expiresAt},AccessToken.prototype.expired=function(){var e=Date.now?Date.now():(new Date).valueOf();return this.expiresAt<=e};var sacct=saveAccToken;function getCurrentAccessToken(){return TW().accessToken}var gcacct=getCurrentAccessToken;function getValidAccessToken(e){var t=getCurrentAccessToken(),r=null,n=APW();if(t.expired()){TW().Assert.assert(null!=n.$,"[getValidAccessToken] JQuery est requis dans le contexte d'execution de la page applicative.");var a=n.getMsgUtil().getMessage(AccessToken.REFRESH_TOKEN_URI),s=new Object;s[AccessToken.CURRENT_ACCESS_TOKEN_PARAM]=t.token,n.$.ajax({type:"POST",url:a,async:!1,timeout:3e3,data:s,dataType:"json"}).done((function(e,t,n){saveAccToken(e),r=getCurrentAccessToken()})).fail((function(t,r,n){TW().Assert.assert(null!=e,"[getValidAccessToken] Erreur, mais in_onErrorCallBack indéfini.");var a=t.responseJSON;e(null!=a?a:{errorcode:r,errorMessage:n})}))}else r=t;return r}var gvacct=getValidAccessToken;function toOAuth2Header(e){TW().Assert.assert(null!=e,"[toOAuth2Header] le paramètre token ne peut être null");var t=e.type,r=e.token;return r.search(t)<0?t+" "+r:r}
//# sourceMappingURL=token.js.map
